<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <!-- å¼•å…¥ Tailwind CSS èˆ‡ Google å­—é«” -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'M PLUS Rounded 1c', sans-serif; 
      background-color: #fffaf0; 
      color: #5d4037;
    }
    
    /* æ—¥ç³»æ‰‹ç¹ªæ„Ÿé‚Šæ¡† */
    .hand-drawn-border {
      border: 3px solid #5d4037;
      border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
    }

    /* ä¾¿æ¢ç´™é¡è‰²æ¨£å¼ (æ·¡è‰²ç³») */
    .note-red { background-color: #ffe4e6; border: 2px solid #fda4af; }
    .note-blue { background-color: #e0f2fe; border: 2px solid #bae6fd; }
    .note-purple { background-color: #f3e8ff; border: 2px solid #e9d5ff; }

    /* é¡è‰²æŒ‰éˆ•è¢«é¸ä¸­çš„æ•ˆæœ */
    .color-ring { ring-offset-2: 2px; ring-2: 4px; ring-gray-400: 1; }
    .selected-color { outline: 3px solid #8b5cf6; outline-offset: 2px; }

    /* ç­†è¨˜æœ¬è£è¨‚ç·š */
    .notebook-spine {
      border-left: 12px solid #eecfa1;
    }

    /* æ»¾å‹•æ¢ç¾åŒ– */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
  </style>
</head>
<body class="p-4 md:p-10">

  <div class="max-w-6xl mx-auto">
    <!-- æ¨™é¡Œ -->
    <header class="text-center mb-8">
      <h1 class="text-3xl font-bold tracking-wider">ğŸ§¸ æˆ‘çš„æ—¥ç³»æ‰‹ç¹ªä¾¿æ¢ç´™ ğŸ§¸</h1>
      <p class="text-sm text-gray-500 mt-2">è¨˜éŒ„æ¯ä¸€å¤©çš„é»é»æ»´æ»´</p>
    </header>

    <!-- ç­†è¨˜æœ¬ä¸»å®¹å™¨ -->
    <div class="flex flex-col md:flex-row bg-white rounded-3xl shadow-2xl overflow-hidden notebook-spine min-h-[650px] border-2 border-gray-100">
      
      <!-- å·¦å´ï¼šè¼¸å…¥å€åŸŸ -->
      <div class="w-full md:w-5/12 p-8 border-b-2 md:border-b-0 md:border-r-2 border-dashed border-gray-200 bg-white">
        <div class="flex items-center gap-2 mb-6">
          <span class="text-2xl">âœï¸</span>
          <h2 class="text-xl font-bold">å¯«ä¸‹æ–°ä»»å‹™</h2>
        </div>
        
        <div class="space-y-6">
          <!-- æ—¥æœŸé¸æ“‡ -->
          <div>
            <label class="block text-sm font-bold text-gray-400 mb-2 ml-1">é¸æ“‡æ—¥æœŸ</label>
            <input type="date" id="taskDate" class="w-full p-3 hand-drawn-border outline-none bg-white">
          </div>

          <!-- å…§å®¹è¼¸å…¥ -->
          <div>
            <label class="block text-sm font-bold text-gray-400 mb-2 ml-1">å…§å®¹</label>
            <textarea id="taskContent" placeholder="åœ¨æ­¤è¼¸å…¥å¾…è¾¦äº‹é …..." 
              class="w-full p-4 hand-drawn-border h-40 outline-none bg-yellow-50/20 resize-none"></textarea>
          </div>
          
          <!-- é¡è‰²é¸æ“‡ -->
          <div>
            <label class="block text-sm font-bold text-gray-400 mb-2 ml-1">ä¾¿æ¢é¡è‰²</label>
            <div class="flex gap-4 items-center">
              <button onclick="setColor('note-red', this)" id="defaultColor" class="w-10 h-10 rounded-full note-red cursor-pointer transition-transform hover:scale-110 selected-color"></button>
              <button onclick="setColor('note-blue', this)" class="w-10 h-10 rounded-full note-blue cursor-pointer transition-transform hover:scale-110"></button>
              <button onclick="setColor('note-purple', this)" class="w-10 h-10 rounded-full note-purple cursor-pointer transition-transform hover:scale-110"></button>
            </div>
          </div>

          <!-- æŒ‰éˆ•å€ -->
          <div class="grid grid-cols-2 gap-4 pt-4">
            <button onclick="handleSave('Today')" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-3 rounded-2xl shadow-md transition-all active:scale-95">åŠ å…¥ä»Šæ—¥</button>
            <button onclick="handleSave('Pending')" class="bg-blue-400 hover:bg-blue-500 text-white font-bold py-3 rounded-2xl shadow-md transition-all active:scale-95">åŠ å…¥å°šæœªå®Œæˆ</button>
          </div>
        </div>
      </div>

      <!-- å³å´ï¼šé¡¯ç¤ºå€åŸŸ -->
      <div class="w-full md:w-7/12 p-8 bg-gray-50/50 overflow-y-auto max-h-[700px]">
        
        <!-- ä»Šæ—¥å¾…è¾¦å€å¡Š -->
        <div class="mb-10">
          <h3 class="text-lg font-bold text-rose-400 border-b-2 border-rose-200 mb-4 pb-1 flex items-center gap-2">
            ğŸ“ ä»Šæ—¥å¾…è¾¦äº‹é …
          </h3>
          <div id="todayList" class="space-y-4">
            <!-- å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
          </div>
        </div>
        
        <!-- å°šæœªå®Œæˆå€å¡Š -->
        <div>
          <h3 class="text-lg font-bold text-purple-400 border-b-2 border-purple-200 mb-4 pb-1 flex items-center gap-2">
            â³ å°šæœªå®Œæˆäº‹é …
          </h3>
          <div id="pendingList" class="space-y-4">
            <!-- å‹•æ…‹ç”Ÿæˆå…§å®¹ -->
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    let selectedColor = 'note-red';
    
    // åˆå§‹åŒ–è¨­å®šï¼šæ—¥æœŸèˆ‡é è¨­é¡è‰²
    window.onload = () => {
      document.getElementById('taskDate').valueAsDate = new Date();
      refreshData();
    };

    function setColor(color, btn) {
      selectedColor = color;
      // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„é¸ä¸­æ¨£å¼
      document.querySelectorAll('.rounded-full').forEach(b => b.classList.remove('selected-color'));
      // åŠ ä¸Šç•¶å‰æŒ‰éˆ•çš„é¸ä¸­æ¨£å¼
      btn.classList.add('selected-color');
    }

    // é‡æ–°å¾å¾Œç«¯æŠ“å–è³‡æ–™
    function refreshData() {
      google.script.run.withSuccessHandler(renderTasks).getTasks();
    }

    function handleSave(type) {
      const content = document.getElementById('taskContent').value;
      const date = document.getElementById('taskDate').value;
      
      if(!content.trim()) {
        alert("è«‹å¯«ä¸‹å…§å®¹å–”ï¼ğŸ¥º");
        return;
      }

      const task = { content, date, type, color: selectedColor };
      
      // å‘¼å« GAS å¾Œç«¯
      google.script.run
        .withSuccessHandler((tasks) => {
          renderTasks(tasks);
          document.getElementById('taskContent').value = ''; // æ¸…ç©ºè¼¸å…¥æ¡†
        })
        .withFailureHandler((err) => alert("å‡ºéŒ¯äº†: " + err))
        .addTask(task);
    }

    function deleteTask(id) {
      if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™å¼µä¾¿æ¢ç´™å—ï¼Ÿ")) return;
      
      google.script.run
        .withSuccessHandler(renderTasks)
        .withFailureHandler((err) => alert("åˆªé™¤å¤±æ•—: " + err))
        .deleteTask(id);
    }

    function renderTasks(tasks) {
      const todayList = document.getElementById('todayList');
      const pendingList = document.getElementById('pendingList');
      
      todayList.innerHTML = '';
      pendingList.innerHTML = '';

      if (!tasks || tasks.length === 0) {
        const emptyMsg = '<p class="text-gray-400 text-sm italic text-center py-4">ç›®å‰ç©ºç©ºå¦‚ä¹Ÿï½</p>';
        todayList.innerHTML = emptyMsg;
        pendingList.innerHTML = emptyMsg;
      }

      tasks.forEach(task => {
        // å»ºç«‹ä¾¿æ¢ç´™ HTML çµæ§‹
        const cardHtml = `
          <div class="${task.color} p-4 rounded-xl shadow-sm flex justify-between items-start transform transition-all hover:rotate-1 border-l-8 border-black/5 relative group">
            <div class="flex-1">
              <div class="text-xs font-bold opacity-50 mb-1">ğŸ“… ${task.date}</div>
              <div class="text-gray-800 whitespace-pre-wrap">${task.content}</div>
            </div>
            <button onclick="deleteTask('${task.id}')" 
              class="ml-2 bg-white/50 hover:bg-white text-red-400 rounded-full w-8 h-8 flex items-center justify-center transition shadow-sm">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
              </svg>
            </button>
          </div>
        `;
        
        if(task.type === 'Today') {
          todayList.innerHTML += cardHtml;
        } else {
          pendingList.innerHTML += cardHtml;
        }
      });
    }
  </script>
</body>
</html>